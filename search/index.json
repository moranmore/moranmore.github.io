[{"content":"前言 通过Headscale和tailscale可以实现远程组建局域网，远程访问家中资源的目的。\n或者在A地访问B地资源较慢的时候，可以通过Headscale+tailscale组件局域网，加速访问资源。\nOr可以让多台设备加入一个公网VPS，让不同地点的用户访问对方的本地资源等。\n准备 1，准备一个具有公网ip的vps，一个主机（个人设备，用于接入VPS搭建的局域网中）。\n2，在vps上安装headscale，在主机上安装tailscale。\n安装Headscale 按照官网的方式进行安装：https://headscale.net/running-headscale-linux/#installation\n1 2 3 4 5 6 7 8 9 10 11 # 更新 sudo apt update sudo apt upgrade # 下载安装包，注意修改flag里面的标志，这里的版本时根据repo中的最新版本修改 wget --output-document=headscale.deb https://github.com/juanfont/headscale/releases/download/v0.22.3/[flag:headscale_0.xx.xx_linux_amd64.deb] # 安装deb包 sudo dpkg --install headscale.deb systemctl daemon-reload # 重新载入配置文件 systemctl enable --now headscale # 开机自动启动 sudo systemctl enable headscale sudo systemctl start headscale 修改配置文件内容\n1 2 3 4 5 # 编辑配置文件 vim /etc/headscale/config.yaml # 修改以下内容 server_url:http://[flag:your vps public ip address]:8080 listen_url:0.0.0.0:8080 1 2 # 新建命名空间 headscale users create [flag:namespace] # 最后参数为命名空间的名字 一些安装信息\n1 2 3 4 5 6 # 数据库安装位置 /var/lib/headscale/db.sqlite # 如果配置文件出错，重新下载配置文件 wget https://github.com/juanfont/headscale/raw/main/config-example.yaml -O /etc/headscale/config.yaml　# 如果报错，可能需要修改配置文件中的 unix_socket: /var/lib/headscale/headscale.sock 安装Tailscale 如果想要实现在VPS上搭建局域网用于多用户实现访问某个资源的ip看起来是一样的，需要在VPS上安装Headscale和Tailscale，即同时作为服务端和一个节点。\nLinux 下载客户端：https://tailscale.com/kb/1039/install-ubuntu-2004/\n1 2 3 4 curl -fsSL https://pkgs.tailscale.com/stable/ubuntu/focal.noarmor.gpg | sudo tee /usr/share/keyrings/tailscale-archive-keyring.gpg \u0026gt;/dev/null curl -fsSL https://pkgs.tailscale.com/stable/ubuntu/focal.tailscale-keyring.list | sudo tee /etc/apt/sources.list.d/tailscale.list sudo apt-get update sudo apt-get install tailscale 如果无法直接弹出注册的token就按照提示命令，直到弹出nodekey\n1 2 3 4 # 等号后面的是安装headscale的主机，默认端口8080 回显会有..... nodekey:... tailscale up --login-server=http://[flag: your vps public ip address]:8080 # 接受注册 把nodekey按照下面的格式在安装了headscale的主机上运行bash headscale --user [flag:name of registed user] nodes register --key nodekey:xxxxx Windows 访问http://[flag: your vps public ip address]:8080/windows按照步骤，添加注册表，输入命令，在VPS注册节点。\n外部节点（Exit node） 添加外部节点\n将部署有headscale的机器作为外部节点，也就是将vps本机加入node的方式，实现通过外部节点访问互联网的目的（比如从局域网）。\n1 2 3 4 5 6 7 sudo tailscale set --exit-node [flag: VPS hostname] tailscale up --advertise-exit-node --login-server=http://[flag: your vps public ip address]:8080 sudo tailscale up --advertise-exit-node # 运行完上面的命令之后，在vps上查看路由 headscale routes list # 开启路由：标志位是上面命令现实出来的第一列参数：ID，在一个外部节点的情况下直接enable前两个路由 headscale routes enable -r [flag] 1 sudo tailscale set --exit-node 外部节点名称 删除节点\n1 headscale node delete -i 如果需要将Windows机器作为内网转发的机器，需要设置Windows的转发规则，并login到server。\n更改节点 1 2 3 4 5 6 # 删除节点 headscale nodes delete [flags] # x 这里指代的是第一列标志的ID序号 headscale nodes delete -i x # 启动路由 headscale node route enable -a -i 启动代理 访问外部网络的主机上（这里是linux），如在局域网 使用exit node：\n1 sudo tailscale set --exit-node [flag: exit node ] 切换服务端 windows平台先修改注册表，然后访问新的注册网址。\n访问新的内网ip对应端口的windows，:\n1 http://[flag: your vps public ip address]:8080/windows 将HKLM\\Software\\Tailscale IPN 的值改为新的ip地址的值,重新用注册机器的方式注册一遍。\nHeadscale常用状态检测命令 1 2 3 4 5 6 7 8 9 10 # 查看所有命名空间 headscale namespace list # 列出所有节点信息 headscale node list # 查看部署日志 journalctl -u headscale # 查看运行状态 systemctl status headscale # 重启服务 service headscale restart 参考文章 https://headscale.net/\nhttps://github.com/juanfont/headscale\nhttps://icloudnative.io/posts/how-to-set-up-or-migrate-headscale\n","date":"2023-12-30T11:04:46+08:00","permalink":"https://expanse.rsvp/p/headscale%E4%B8%8Etailscale%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8%E4%BD%93%E9%AA%8C/","title":"Headscale与tailscale简单使用体验"},{"content":"前言 使用Docker+Cloudflare可以在自己的VPS服务器上搭建简易的静态网站。\n采用的镜像为nginx镜像，同时在主机用nginx反向代理实现转发功能，使得输入域名就能访问相应的容器端口。\n简单的说，可以通过反向代理，实现在输入不同的域名来访问主机的80端口时，将请求转发到其他的自定义端口，更容易部署和修改网站的服务。同时使用Cloudflare将解析指向自己的VPS，隐藏VPS真实IP。\n对于原理没有特别多的解释，但是按照步骤来能实现稳定的访问。\n在VPS上使用docker搭建简单静态网站并使用cloudflare\nDockerfile 静态网站只有一个主页，直接copy到html目录下就行（半年以内用docker-compose搭建复杂一点的网站）\n1 2 3 4 5 6 7 FROM nginx:latest COPY index.html /usr/share/nginx/html/index.html EXPOSE 80 CMD [\u0026#34;nginx\u0026#34;, \u0026#34;-g\u0026#34;, \u0026#34;daemon off;\u0026#34;] Cloudflare DNS设置 Websites添加购买的域名\nAdd a site\n在输入框中输入域名\nDNS设置\n这里可以直接继续，然后回到域名停放服务商，更改如下配置，一般找到含有nameservers相关选项更改\n添加记录\n完成\n和http、https有关的设置\n接下来就是检查设置完成状态（完成后会发送邮件）\n修改记录 左侧DNS设置\n修改记录，使用一条A记录指向VPS主机\nSSL TLS设置 采用Strict模式（四种模式区别主要在于是否采用加密，是否采用VPS到Cloudflare之间加密）\n证书类别\n边缘证书：指从用户浏览器到Cloudflare之间的加密证书\n服务端证书：指Cloudflare到VPS之间加密证书\n边缘证书是已经设置好的，会自动续期，不需要更改这里的配置\n设置客户端证书\n把pem格式证书存到本地\n设置Origin Server加密（Customize encryption of traffic between your origin server and Cloudflare.）\n设置说明\n1 2 3 4 5 # Origin Certificate Installation Save the certificate and private key below to your client. To save, Click to copy and paste the contents into different files on your client, e.g. example.com.pem and example.com.key # Origin Certificate # Private key Copy the contents of your private key below to your web server and set file permissions such that only your http server can access it. Additionally, you can optionally encrypt this file and provide a password to decrypt it during your origin web server startup. The private key data will not be stored at Cloudflare and will no longer be accessible once the creation is complete. Please make sure you have a local copy of this key. Nginx反向代理 在宿主机上安装nginx\n1 2 3 4 5 6 7 8 9 sudo apt update sudo apt install nginx sudo systemctl start nginx sudo systemctl enable nginx # after config sudo systemctl reload nginx sudo systemctl restart nginx # stop sudo systemctl stop nginx 配置文件xxxx.conf 存放的位置/etc/nginx/sites-available/[flag].conf\n这里的域名和端口都需要按照个人的需求更改[flag: 说明]。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 server { listen 80; return 301 https://$host$request_uri; } server { server_name [flag:domain]; listen 443 ssl http2; ssl on; ssl_session_cache builtin:1000 shared:SSL:10m; ssl_protocols TLSv1 TLSv1.1 TLSv1.2; ssl_ciphers HIGH:!aNULL:!eNULL:!EXPORT:!CAMELLIA:!DES:!MD5:!PSK:!RC4; ssl_prefer_server_ciphers on; ssl_certificate /etc/nginx/[flag:path to store key]/[flag:domain].pem; ssl_certificate_key /etc/nginx/[flag:path to store key]/[flag:domain].key; location / { proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_read_timeout 90; proxy_redirect http://[flag:host ip]:[flag:host port] https://[flag:domain]; proxy_pass http://[flag:host ip]:[flag:host port]; } } 软链接sudo ln -s /etc/nginx/sites-available/proxy.conf /etc/nginx/sites-enabled/，完成配置之后重启nginx服务。\n1 2 sudo systemctl reload nginx sudo systemctl restart nginx 启动 1 2 3 4 5 6 7 8 # 根据当前目录Dockerfile生成image docker build -t [flag] . # 运行 docker run -d -p [flag:host port]:80 --name [flag:container name] [flag:image name]:[flag:image tag] sudo systemctl start nginx.service sudo systemctl enable nginx.service # 检查nginx状态 systemctl status nginx ","date":"2023-12-24T23:18:59+08:00","permalink":"https://expanse.rsvp/p/%E4%BD%BF%E7%94%A8docker%E6%90%AD%E5%BB%BA%E7%AE%80%E5%8D%95%E9%9D%99%E6%80%81%E7%BD%91%E7%AB%99/","title":"使用Docker搭建简单静态网站"},{"content":"ssh-keygen是用于生成ssh密钥对的程序，可以生成多种非对称加密（如RSA、ECC等）的密钥对，用于SSH登录认证或者其他需要使用签名的场合等等（如Github登录或仓库Actions的运行等）。\nopenssl\u0026amp;ssh-keygen 两种生成密钥对的方法 使用ssh-keygen 加对应的选项参数即可生成相关的密钥对，生成一个默认的密钥对只需要运行ssh-keygen按照提示操作（默认目录是在家目录的.ssh目录中），以下是使用参数生成的密钥对，并指定目录\n1 ssh-keygen -t rsa -b 1024 -C \u0026#34;\u0026#34; 生成RSA密钥对(1024bits)\n1 openssl genrsa -out test.key 1024 openssl读取私钥 使用openssl读取私钥\n1 openssl rsa -in test.key -text 私钥结构 RSA私钥 一个RSA私钥的结构中包含了如下的几个部分。\n$\\text{n}$模数 $\\text{e}$公共指数，默认为65537 $\\text{d}$私钥 $\\text{p(q)}$第一个大质数 $\\text{q(p)}$第二个大质数 $\\text{dp}:d\\pmod{p-1}$dp $\\text{dq}:d\\pmod{q-1}$dq $\\text{coefficient}:q^{-1}\\pmod{p}$ 使用Python读取RSA私钥 1 2 3 4 5 6 7 8 9 10 11 from Crypto.PublicKey import RSA from Crypto.Util.number import * with open(\u0026#34;test.key\u0026#34;,\u0026#34;rb\u0026#34;) as f: content = f.read() key = RSA.import_key(content) assert isPrime(key.q) and isPrime(key.p) and key.p*key.q==key.n print(key.e) print(key.n) print(key.q) print(key.p) 密钥格式 输入的命令不同，生成的私钥内容也是有去别的，如果使用默认的ssh-keygen生成的私钥文件是无法通过Openssl直接读取的，如果想要通过Openssl命令读取rsa私钥文件，需要在生成的时候使用openssl命令。\n这两种文件格式的开头和结尾也有区别，如果使用ssh-keygen命令直接创建，开头和结尾为：-----BEGIN OPENSSH PRIVATE KEY-----和-----END OPENSSH PRIVATE KEY-----此时生成的是ssh的密钥；如果使用Openssl命令并指定的加密算法创建密钥对，生成的密钥对的开头和结尾是：-----BEGIN PRIVATE KEY-----和-----END PRIVATE KEY-----,这两种密钥对形式有相似，但是并不是一样的密钥类型，无法使用openssl rsa .....命令读取ssh-keygen生成的ssh密钥，所以使用openssl命令读取ssh-keygen的私钥的时候无法成功。\nReference OpenSSL - wiki\nOpenSSL - Toolkit\nssh-keygen - wiki\nssh-keygen manual\nWhat are the differences between ssh generated keys(ssh-keygen) and OpenSSL keys (PEM)and what is more secure for ssh remote login?\n[For valid PEM I get unable to load private key by openssh](https://superuser.com/questions/1679344/for-valid-pem-i-get-unable-to-load-private-key-by-openssh)\nRECOVERING A FULL PEM PRIVATE KEY WHEN HALF OF IT IS REDACTED\nPyCryptodome - readthedocs\n","date":"2023-11-05T16:01:57+08:00","permalink":"https://expanse.rsvp/p/ssh-keygen%E4%B8%8E%E5%AF%86%E9%92%A5%E6%A0%BC%E5%BC%8F/","title":"ssh-Keygen与密钥格式"},{"content":"前言 本文主要记录的是CTF比赛 Crypto类中环境的搭建，根据本人的需要会随时更新文章，等不更新了就说明环境基本没什么变化了。\n系统 Homebrew的安装(二进制文件安装似乎不是很好用，总是报错)：\n1 2 3 4 5 6 7 # https://brew.sh/index_zh-cn # 或者使用命令； # 访问bin：https://github.com/Homebrew/brew/releases/tag/4.1.9，使用pkg安装 /bin/bash -c \u0026#34;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/uninstall.sh)\u0026#34; # 卸载 /bin/bash -c \u0026#34;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)\u0026#34;# 安装 brew doctor brew cleanup go环境安装：\n1 2 # https://go.dev/dl/ brew install go hugo安装：\n1 2 3 sudo chown -R $(whoami) /usr/local/opt chmod u+w /usr/local/opt brew install hugo python python的环境搭建比较简单，只需要安装几个固定的库就可以了，vscode 就能满足条件，这个不需要其他太多的东西，常用的库有如下几个：\n1 2 3 4 5 6 7 8 9 10 11 gmpy2 pycryptodome sympy # 自带mpmath numpy pwntools #https://pwntools-docs-zh.readthedocs.io/zh_CN/dev/install/binutils.html#mac-os-x # pwntools的安装需要预先安装binutils ，最好的方式是git clone 下来之后用shell安装 git clone https://github.com/Gallopsled/pwntools-binutils.git cd pwntools-binutils/ cd macos ./install_all.sh # 出错是正常的，因为架构的问题，安装不上arm的版本没关系 # 可以试试install.sh 选择全安装在mac上安装和构建花了很久，而且报错很多 写一个python的环境安装txt吧：\n1 2 3 4 5 6 7 8 # mac os env # requirements.txt gmpy2 pycryptodome sympy numpy pwntools pyelftools == 0.29 pwntools安装 python3.9的支持似乎不是很好，准备一个3.10.11试试,这里有两种下载的方式，一种是源码，另一种是安装文件，其中源码提供了tgz文件，这里先用安装包安装了，太麻烦了:\n1 2 #https://www.python.org/downloads/macos/ #https://www.python.org/downloads/release/python-31013/ 可以发现python3.10的启动是通过python3.10的bash指令启动，而不是python3，需要将python3.10.11设置为默认的python版本，并设置相关的库。（看下面，不用设置，改vsc的就行，直接在python3.10里面安装库）\n反转了，是版本问题，直接改vsc的配置，然后把pwntools的其中依赖库改为0.29🔗:\n1 pip3 install pyelftools==0.29 # 完事 pwntools的安装有些麻烦，在mac上构建binunits总会有各种奇怪的错误：\n1 2 3 4 5 6 7 brew cleanup binutils brew install binutils brew reinstall binutils echo \u0026#39;export PATH=\u0026#34;/usr/local/opt/binutils/bin:$PATH\u0026#34;\u0026#39; \u0026gt;\u0026gt; ~/.profile export LDFLAGS=\u0026#34;-L/usr/local/opt/binutils/lib\u0026#34; export CPPFLAGS=\u0026#34;-I/usr/local/opt/binutils/include\u0026#34; brew update 还有一些github开源的工具，都可以安装，不过后者就是一些固定的脚本，最后就是一些自己收集的现成脚本之类的了。\nmac下python的环境配置,在当前打开的工作区中,也可以把这些加入用户的设置中(settings.json)：\n1 2 3 4 5 \u0026#34;code-runner.runInTerminal\u0026#34;: false, // 这里的话true是在终端输出结果，false是在输出栏那边输出 \u0026#34;python.pythonPath\u0026#34;: \u0026#34;/usr/local/bin/python3\u0026#34;, \u0026#34;code-runner.executorMap\u0026#34;: { \u0026#34;python\u0026#34;: \u0026#34;python3 -u\u0026#34; }, Sagemath sage是一个开源的数学软件，用于进行一些数学运算，特别是有关代数的相关运算。\nsage对于windows的支持在9.3，而在linux上的支持较新，如果在linux上安装也是可以的，不过在mac上可以直接安装sage，毕竟sage提供了很多快捷的函数。\nsage的二进制版本下载：https://github.com/3-manifolds/Sage_macOS/releases。因为笔者的笔记本还是Intel的处理器，所以下载的是x86的dmg文件，现在的Mac应该下载的都是ARM版本的了吧（大概）。截止到2023年秋季，sagemath对于Mac支持到了10.x的版本，相比Windows新了不少，而且直接下载mac版本的sage，可以不需要Linux安装sage那么麻烦。\n下载完成后直接拖动就行了，一般情况下不需要配置多余的内容。此时下方栏中会有一个sage的图标，点开的时候会提供选项是进入哪个环境。比如会有一个shell和jupyter的环境可以选择，一般个人习惯用jupyter了，比如可以选择jupyter v7，需要注意的是，sage里面需要重新安装上面提到的库才能运行，否则是无法运行上面的库中的函数，也无法导入。\nsage安装包安装时没问题的，可以正常打开。\n虚拟机 虚拟机用的是Vmware的Fusion 13Pro，平时快照，备份都还可以。\n其他软件和应用 CyberChef chef是一个集合了很多功能的软件，无论是在线还是本地，都能使用不仅包含编码、加密解密、查看文件等功能。\nciphey ciphey是一个自动工具，但是一般情况是对于英文的识别更好，可以自动解码复杂的编码过程之后的字符串。相关链接：🔗\n1 2 python3 -m pip install ciphey --upgrade python3 -m pip install -U ciphey 相比chef，ciphey 在处理较为庞大的数据的时候更有优势，但是如果是操作较为复杂的情况下，而且数据规模不大，chef更有优势一些。\n还有一个问题：\nCiphey doesn\u0026rsquo;t work on Windows with Python 3.9+, use Python 3.7 or Python 3.8. Other platforms are fine with Python 3.9, Python 3.10 doesn\u0026rsquo;t work.\n也就是说，这波只能用python3.9跑了，算了，再下一个3.8，我佛了：\n1 2 https://www.python.org/downloads/release/python-3810/ brew install ciphey 总算能用了卧槽了。\nyafu 这是一个集合了多种分解大数的工具，但是有些情况下分解出来的可能是合数，如过模数的生成过程小质数的bit大小相同，则需要判断结果中长度，如果有明显的区别，可能是因为没有分解彻底。\n如果需要运行在虚拟机中，可以考虑安装一个win10的虚拟机，占用不是特别大（安装的软件很少的情况）。\n这个东西不行就算了，还是整个库吧，配个环境累的不行，真绷不住了。\n","date":"2023-09-10T17:25:39+08:00","permalink":"https://expanse.rsvp/p/mac%E6%90%AD%E5%BB%BA%E7%8E%AF%E5%A2%83/","title":"Mac搭建环境"},{"content":"搭建环境 vps使用的是Ubuntu20.04+docker\ndockerfile一般用官方给出来的就行，或者找一个能交互的题目的dockerfile（比赛结束之后去discord或者github）。我的实例中没有用到socket库，这种docker不需要。\n在这里不详细解释更细致的内容，一般情况下需要更改的部分是dockerfile中的python版本，额外的库，其他的直接按照部署docker的方式来就行，测试的时候如果中断可能是网络问题。\n实例 这是一个交互计算的题目，需要通过计算100个乘法运算，获取最终的flag。\ndockerfile 1 2 3 4 5 6 7 8 9 10 FROM python:3.10 # dockerfile of test RUN apt update \u0026amp;\u0026amp; apt upgrade -y RUN apt install socat -y RUN pip install pycryptodome # modify here,from src to dst ADD calculator.py task.py ADD secret.py secret.py # modify EXEC: CMD socat -T 2 -dd -v \u0026gt;/dev/stdout TCP-L:60000,fork,reuseaddr EXEC:\u0026#34;python -u task.py\u0026#34; task script calculator.py:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 import random from secret import flag rounds = 100 welcome = \u0026#34;\u0026#34;\u0026#34; .----------------. .----------------. .----------------. .----------------. | .--------------. || .--------------. || .--------------. || .--------------. | | | _________ | || | _________ | || | _______ | || | _________ | | | | | _ _ | | || | |_ ___ | | || | / ___ | | || | | _ _ | | | | | |_/ | | \\_| | || | | |_ \\_| | || | | (__ \\_| | || | |_/ | | \\_| | | | | | | | || | | _| _ | || | \u0026#39;.___`-. | || | | | | | | | _| |_ | || | _| |___/ | | || | |`\\____) | | || | _| |_ | | | | |_____| | || | |_________| | || | |_______.\u0026#39; | || | |_____| | | | | | || | | || | | || | | | | \u0026#39;--------------\u0026#39; || \u0026#39;--------------\u0026#39; || \u0026#39;--------------\u0026#39; || \u0026#39;--------------\u0026#39; | \u0026#39;----------------\u0026#39; \u0026#39;----------------\u0026#39; \u0026#39;----------------\u0026#39; \u0026#39;----------------\u0026#39; \u0026#34;\u0026#34;\u0026#34; def task(): print(welcome) for _ in range(rounds): a,b = random.randint(1,1000),random.randint(1,1000) c = a*b cho = input(f\u0026#34;Please input your answer of {a}*{b}:\u0026#34;) if cho == str(c): print(\u0026#34;Right!\u0026#34;) else: exit(\u0026#34;Wrong...\u0026#34;) print(f\u0026#34;Here is your flag:{flag}\u0026#34;) task() secret.py:\n1 2 3 4 from uuid import uuid1 # test = \u0026#34;flag{\u0026#34;+str(uuid1()) + \u0026#34;}\u0026#34; # print(test) flag = \u0026#34;flag{.....}\u0026#34; write up 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # solve.py from pwn import * ip=\u0026#34;\u0026#34; port= p = remote(ip,port) pad = \u0026#34;Please input your answer of \u0026#34; p.recvlines(11) # 跳过welcome while 1: res = p.recv() print(res) if b\u0026#34;flag{\u0026#34; in res: exit(res) l = res[len(pad):-1].split(b\u0026#34;*\u0026#34;) ans = str(int(l[0])*int(l[1])) p.sendline(bytes(ans.encode())) a=p.recvline() print(a) bash 1 2 3 4 docker build -t test . # vps端口：容器端口， 容器名称：镜像名称 docker run -d -p 50000:60000 --name cryptotest test # 这样容器一直在运行，只需要nc访问对应的端口就可以了 其他 ASCII艺术字 有时候题目开始的时候会有一个题目的名字显示，在终端中用ascii艺术字展示的，这里有网站可以实现这种方法(或者搜索ascii艺术字也可以)：\n艺术字网站：patorjk\n域名+端口的说明 一些比赛给的靶机带有域名，可以使用反向代理，但是我没有试过，有时间可能会试试（可能有更简单的方法，有时间研究一下）。\n","date":"2023-08-21T05:52:28+08:00","permalink":"https://expanse.rsvp/p/%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BAcrypto%E4%BA%A4%E4%BA%92%E5%9E%8B%E9%A2%98%E7%9B%AE/","title":"快速搭建crypto交互型题目"},{"content":"前言 之前试过在blogger和GitHub Pages搭建博客，也用过docker+WordPress搭建，但是后者因为日志过大，加上markdown写起来不是很方面，所以现在又用hugo+GitHub Pages +Actions来搭，这样markdown写起来方便，离线的时候用起来方便\n优势 对于docker搭建wordpress的博客是很舒服的，不用考虑图床之类的问题。只需要担心的是wordpress插件会不会出问题之类的， 配置需要一些时间，反向代理域名和端口，还有CF配置SSL等。\nhugo相比hexo生成个人感觉好用一些。首先hugo部署很方便，而且环境配置只需要配置环境变量然后就能用了。配置问题主要是Actions的部分，还有就是CF的ip添加一次只能添加一个，比Google的麻烦一些。但是Actions确实很好用，省去了本地生成的麻烦，只需要push到博客仓库就行了（此处的博客仓库是一个私有仓库，不是公开的仓库）。\n部署 首先，需要拥有一个github账号，并且在这个账号中建立两个仓库：\n1.用于存储hugo site的源码，并且在这个仓库中加入Actions的文件，用于实现github的actions生成。\n2.用于存储生成之后的网站的源码，这个仓库就是用于展示的仓库。\n完成前置条件之后，部署博客的大体思路是这样的：\n作者首先安装Go语言的环境和hugo，然后初始化site，配置本地的site文件，推送到github的源码仓库，由源码仓库中的Actions执行生成name.github.io仓库中的内容，打开这个链接就可以访问了，之后配置cloudflare之类的比较简单了。\ngo和hugo环境配置 下载go语言的安装包，添加bin目录到环境变量中（win平台是安装的，所以不需要）：\n下载地址：https://go.dev/dl/\n1 2 3 4 tar -zxvf \u0026#39;下载的文件名字\u0026#39; go # 添加环境变量 export PATH=$PATH:/usr/local/go/bin authorized_keys 安装hugo并且配置hugo\n1 2 3 4 # 下载地址：https://github.com/gohugoio/hugo/releases # 解压缩到对应的目录，然后添加环境变量，当在win中运行 where hugo #如果有结果就说明hugo配置好了 在网站的父目录中创建网站：\n1 hugo new site \u0026#34;your site\u0026#39;s name\u0026#34; 添加主题，因为这个时候的hugo网站是没有主题的，所以需要添加主题，在此之前，先说明hugo在本地的生成是有两种的，一种是hugo server -D这种是生成所有的文章预览，包括草稿，如果开始的框中的draft:true这种情况下，只用hugo server是无法生成预览的，把true改为false，才能生成预览，这种情况之下，及时推送到github然后actions也没有文章可以看到。\n清除git所用的代理配置：\n1 2 3 git config --global --unset http.proxy git config --global --unset https.proxy # 手动删除 ~/.gitconfig 也可以实现重置配置的效果 将theme\\examplseSite里面的config.yoml东西复制出来，放到网站的根目录中，这时候就基本相当于配置好了一个基本的网站了（里面的内容还是examplesite的）。\n推送到github 推送到github需要有两个步骤，首先需要将账户登录到git，这里需要配置密钥对，生成的方式：\n1 2 ssh-keygen -t rsa -b 4096 -C \u0026#34;deploy_github_pages\u0026#34; -f \u0026#39;这里是你想要给密钥的命名\u0026#39; # 生成一个key文件还有一个key.pub文件（假设在-f之后的名字是key） 第一个密钥对：\n首先配置github认证需要的两个密钥，私钥放到本地，公钥上传到Settins|SSH and GPG keys|Authentication Keys 这里。\n然后就可以git来推送文件了。\n第二个密钥对：\n用于连接两个仓库，一个是私有仓库用于存放hugo site根目录中的所有文件，在这个仓库中的Settings|Secrets and variables|中部署私钥，这里的私钥就是类似key里面的内容，直接全部复制到里面就行了，这里的名字要记住，然后在actions中的文件配置需要用到。\n公钥的位置放到name.github.io仓库中的Settings|Deploy keys位置，建议起名字的时候可以和前面的私钥对应，或者方便识别。\n配置好了密钥之后，可以初始化本地仓库，完成之后就可以推送到远程的私有仓库，在私有仓库中的actions页面执行生成静态网站的步骤。\n1 2 3 4 5 git init -b main # 合并仓库到私有仓库 git remote add origin git@github.com:xxx/xxxx.git # 没办法的情况下强行合并 git push -f origin master #注意，这一步可能有问题，建议根据自己的实际的branch更改master或者main 一般情况下如果顺利的部署步骤是：\n1 2 3 4 # cd 到网站的根目录 git add . git commit -m \u0026#34;你为这次推送的评论\u0026#34; git push origin main # 因为我的分支是main，所以推送到main 配置actions actions是一个可以进行自动化测试的工具，比如可以通过配置文件，将源代码生成为./public中的静态网站，并且推送到一个共有的仓库，这样私有仓库中的一些源码等内容不会在共有仓库中显示。\n对于github 的actions工具，会有一个类似shell的运行结果，如果出现了失败，会有报错，根据报错搜索就可以找到解决方案，一般来说google出来的结果可以解决，actions的运行报错类似如\n配置这个文件，需要在网站的根目录中添加目录：.github/workflows/写一个yml格式的文件。\n我的文件格式如下：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 name: Hugo Blog GitHub Pages Actions on: push: branches: - main # Set a branch name to trigger deployment pull_request: jobs: deploy: runs-on: ubuntu-22.04 permissions: contents: write concurrency: group: ${{ github.workflow }}-${{ github.ref }} steps: - uses: actions/checkout@v3.5.3 with: submodules: true # Fetch Hugo themes (true OR recursive) fetch-depth: 0 # Fetch all history for .GitInfo and .Lastmod - name: Setup Hugo uses: peaceiris/actions-hugo@v2 with: hugo-version: \u0026#39;0.114.1\u0026#39; # extended: true - name: Build run: hugo --minify - name: Deploy uses: peaceiris/actions-gh-pages@v3 # If you\u0026#39;re changing the branch from main, # also change the `main` in `refs/heads/main` # below accordingly. if: github.ref == \u0026#39;refs/heads/main\u0026#39; with: external_repository: name/name.github.io # 更改这里适配你的仓库 deploy_key: ${{ secrets.xxxxxx }} #　这里的就是上面提到的私有仓库的私钥 publish_branch: main publish_dir: ./public 这个文件的配置我也是参考了网上的连接，是一个github仓库，在里面会有指导怎么写yml文件，我这个文件是满足部署，可以运行的。\n报错解决 Not submodule 在部署的时候，出现\u0026quot;Not submodule\u0026hellip;\u0026hellip;.\u0026quot;（这里的报错涉及到的是主题），这个需要在根目录中写一个名字是.gitmodules的文件，然后将你的主题的submodule放进去就行，一般hugo的主题有一个仓库是存放了一堆submodule的，在里面更改为如下的方式就好：\n1 2 3 4 5 # 比如我的主题是 hugo-tranquilpeak-theme # 添加如下文件到.gitmodules文件中，需要注意的是目录和双引号中的目录问题，和仓库中的有区别 [submodule \u0026#34;themes/hugo-tranquilpeak-theme\u0026#34;] path = themes/hugo-tranquilpeak-theme url = https://github.com/kakawait/hugo-tranquilpeak-theme.git 或者在添加主题的时候，就将主题以子模组的形式添加到themes文件夹中：\n1 2 # 主题：stack git submodule add https://github.com/CaiJimmy/hugo-theme-stack/ themes/hugo-theme-stack 如果markdown文件中出现了错误，也会导致报错，不放心的话可以在push的时候看着actions的运行状态。\n图片无法显示 设置图片的根目录，在文章首框中加入：\n1 2 3 typora-root-url: ./..\\..\\static # 偏好设置：复制到相对路径 ../../static/images/${filename} 或者将markdown文件命名为：index.md，然后将图片复制到文章的项目目录下，形成如下的结构：\n1 2 ├─2023 │ └─Hugo+GithubPages+Actions博客搭建 这个文章中下含有了文章index.md和图片报错实例，这个图片的名字是可以命名的，这样也好在本地使用。\n站点修改 设置avatar.png 在根目录中的assets文件夹中新建img文件夹，放入avatar.png。\n站点头像 实际目录：/static/images/favicon.ico\n设置：\n1 2 3 4 5 6 params: mainSections: - post featuredImageField: image rssFullContent: true favicon: /images/favicon.ico 设置评论 采用Disqus作为评论系统，只需要更改网站根目录中的config.yaml文件中disqusShortname的值即可，改为Disqus的账户名称（需要注册Disqus账户并且用邮箱激活）。\n需要在Disqus添加站点，访问：🔗，选择I want to install Disqus on my site，选择免费计划，可以不配置平台，然后在配置中一路默认最后选择完成配置就行。\n更换域名、用户名、仓库名字 域名 更换域名需要更换cloudflare的DNS记录，nameserver还给CF的，强制https，A记录添加为185.199.10x.153（x为9-11），代理状态为仅DNS。\n用户名字 如果更换了仓库名字或者github用户名字、域名，需要更改配置文件（ymal中的内容，和hugo.yml external_repository:，static中的CNAME记录，这里可以用everything搜索CNAME修改）。\n一般是更改config中的内容，改为用户名+github\u0026hellip;的形式，域名需要将所有的旧域名替换成新域名，如果出现无法push的情况，可以更换密钥，添加到公开仓库的时候可以勾选上Allow write access，可以解决128报错无法推送的问题。\n报错 如果ssh更新但是没有添加邮箱（-C），可以把私钥名字改为id_rsa重新push。\n发布文章 上面用的是index.md来存放文章内容，所以写新文章的时候用：\n1 2 hugo new .\\content\\post\\2023\\文章标题\\index.md # 或者直接new post也可以 这样图片直接复制到当前文件夹就行了。\n开启KaTex支持 通过修改根目录下的config.yaml中的\n1 2 article: math: true 即可开启数学公式支持。\n双机更新 如果有两个不同系统的笔记本，比如一个Ubuntu和一个Windows，可以在两个设备上同时clone下来仓库，比如已经完成了另一个设备上的git安装，还没clone仓库到本地时候。\n首先将私钥复制到用户目录的ssh文件中，然后在相关目录中直接：\n1 git clone ...... 发生更新之后，即使博客的更新只有一个人，但是仍然需要检查是不是相比仓库发生了更新，如在win上更新之后但是没有pull，但是mac端先pull 到主要分支，如果下次在win上直接pull而不比较内容，会出现覆盖mac端pull的情况，所以需要检测当前的版本是不是最新的，如果和远程仓库有区别需要先把远程仓库的更新拉到本地然后pull：\n1 2 3 4 5 6 git fetch # 会在不更新本地仓库的情况下获取远程仓库的更新情况 git diff --stat main origin/main # 比较本地和远程仓库内容区别,如果没有结果就是ok，如果有区别，视情况选择merge git merge # 将远程已经更新的内容更新到本地 # 如果merge 报错，如果确定了远程是需要拉到本地的情况，就stash git stash git merge 到此就完成了两个主机上博客的更新部署，只不过需要在更新的时候先检查远程和本地的区别，然后再选择是否更新。\n报错 参考：如果git diff无反应怎么办\nmerge 报错：如果merge提示报错怎么办\nhugo server 出现Page not found：\n1 2 3 WARN found no layout file for \u0026#34;html\u0026#34; for layout \u0026#34;archives\u0026#34; for kind \u0026#34;page\u0026#34;: You should create a template file which matches Hugo Layouts Lookup Rules for this combination. WARN found no layout file for \u0026#34;html\u0026#34; for kind \u0026#34;page\u0026#34;: You should create a template file which matches Hugo Layouts Lookup Rules for this combination. WARN found no layout file for \u0026#34;html\u0026#34; for layout \u0026#34;search\u0026#34; for kind \u0026#34;page\u0026#34;: You should create a template 这种情况就是hugo的theme文件夹中的主题问题，因为之前配置过submodule，github pull下来之后，发现主题文件夹是空的，因为之前改过主题，所以直接把主题过来了，此时在生成就是动态的网页了。\n参考 Hugo actions的指导：https://github.com/peaceiris/actions-hugo\n报错解决：https://www.youtube.com/watch?v=DMgEGpqXEM4\n主题gitmodules：https://github.com/gohugoio/hugoThemes/blob/master/.gitmodules\n标题无法从一级标题开始显示：https://huweim.github.io/post/blog_hugo_%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84/\n","date":"2023-06-29T02:03:52+08:00","permalink":"https://expanse.rsvp/p/hugo-githubpages-actions%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/","title":"Hugo+GithubPages+Actions博客搭建"}]